@{
    ViewBag.Title = "SpeedTrapper";
    Layout = null;
}
@Scripts.Render("~/bundles/jquery")

<script src="~/Scripts/jquery.signalR-2.2.0.js"></script>
<!--Reference the autogenerated SignalR hub script. -->
<script src="~/signalr/hubs"></script>
<div style="display:inline-block; border-bottom:solid; width:100%; font-family:Arial ; padding-bottom:20px ;border-bottom-color:aqua;">
    <span style="font-size:x-large; color:forestgreen">Speed Trap</span>&nbsp;&nbsp;&nbsp;
    Overspeed: @Html.TextBox("overspeed", "", new { onkeydown = "return ValidateNumber(event);" })
    <input type="button" id="sendoverspeed" value="Apply" />
</div>
<br />
<br />
<div id="discussion" style=" display:inline; font-family:Arial "></div>
<script>
    $(function () {

        // Reference the auto-generated proxy for the hub.
        var chat = $.connection.SpeedTrapperHub;


        // Create a function that the hub can call back to display messages.
        chat.client.addNewMessageToPage = function (name, message, speed) {
            // Add the message to the page.

            if (message <= speed)
            { $('#discussion').append('<div  style=" float:left;display: inline;margin-left:10px;"><span style="font-size:x-large; ">' + name + '</span><br />    <span style="font-size:x-large; color:forestgreen">' + message + 'km'+'</span></div>'); }

            else { $('#discussion').append('<div  style=" float:left;display: inline;margin-left:10px;"><span style="font-size:x-large; ">' + name + '</span><br />    <span style="font-size:x-large; color:red">' + message +"km"+ '</span></div>'); }

        };
        $.connection.hub.start({ waitForPageLoad: true }, function () {

        });
        $('#sendoverspeed').click(function () {
            // Call the Speed method on the hub.
            if ($('#overspeed').val() <= 200) {
                chat.server.SetSpeed($('#overspeed').val());
                $('#discussion').empty();
                $("#discussion").html("");

            }
            else {
                alert("Speed can not be more than 200km");
                $('#overspeed').val("");
            }


        });
    });
    // This optional function html-encodes messages for display in the page.
    function htmlEncode(value) {
        var encodedValue = $('<div />').text(value).html();
        return encodedValue;
    }


    function ValidateNumber(e) {
        var evt = (e) ? e : window.event;
        var charCode = (evt.keyCode) ? evt.keyCode : evt.which;
        if (charCode > 31 && (charCode < 48 || charCode > 57)) {
            return false;
        }
        return true;
    };
</script>